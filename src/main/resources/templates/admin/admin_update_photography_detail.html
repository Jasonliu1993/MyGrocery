<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Page Description"/>
    <meta name="author" content="Jason"/>
    <title>更新分享</title>

    <!-- Bootstrap -->
    <!--<link href="/css/bootstrap-3.3.7/css/bootstrap.css" rel="stylesheet"/>-->
    <link href="/css/common/pagination.css" rel="stylesheet"/>
    <link href="/css/common/common.css" rel="stylesheet"/>

    <link href="/css/bootstrap-3.3.7/css/bootstrap.css" rel="stylesheet">
    <link href="/plugins/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css"/>-->
    <link href="/plugins/bootstrap-fileinput/themes/explorer-fa/theme.css" media="all" rel="stylesheet"
          type="text/css"/>
    <script src="/js/jquery-3.1.1.min.js"></script>
    <script src="/plugins/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/js/locales/fr.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/js/locales/es.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/themes/explorer-fa/theme.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/themes/fa/theme.js" type="text/javascript"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" type="text/javascript"></script>-->
    <script src="/js/bootstrap-3.3.7/js/bootstrap.js" type="text/javascript"></script>

    <style>
        .theme {
            background-color: #2e3032;
        }

        .set-margin-top {
            margin-top: 20px;
        }

        .set-full {
            width: 100%;
            height: 586px;
            background-color: white;
            border-radius: 3px;
        }

        .set-color-white {
            color: white;
        }

        .preView {
            text-align: center;
        }

        #displayImage {
            width: 80%;
            height: 60%;
        }

        #image {
            display: none;
        }

    </style>

    <script>
        $(document).ready(function () {
            var baseURL = window.location.host;
            var protocol = window.location.protocol;

            $(document).ready(function () {
                /*<![CDATA[*/
                $("#saveBtn").on("click", function () {
                    var photoRefId = $("#photoRefId").val();
                    if(photoRefId !== null && photoRefId !== undefined && photoRefId !== '') {
                        $("#formSubmit").submit();
                    } else {
                        alert("请上传图片")
                    }
                })
                /*]]>*/
            })

            $('#imageUpload').on('filedeleted', function(event, key, jqXHR, data) {
                $("#photoRefId").val("");
            });

            $("#imageUpload").fileinput({
                theme: 'fa',
                uploadExtraData: {kvId: '10'},
//                uploadUrl: 'http://localhost/file-upload-single/1',
                uploadAsync: true,
                showUpload: true,
                showCaption: true,
                showPreview: true,
                showUploadedThumbs: true,
//            browseClass: "btn btn-primary btn-lg",
                fileType: "any",
                previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
                overwriteInitial: false,
                initialPreviewAsData: true,
                initialPreview: [
                    protocol + "//" + baseURL + "/image/photography/" + $("#photoRefId").val(),
                ],
                initialPreviewConfig: [
                    {caption: "transport-1.jpg", size: 329892, width: "120px", url: "/image/deletePhotography/" + $("#photoRefId").val(), key: 1},
                ],
            }).on("filebatchselected", function (event, files) {
                $(this).fileinput("upload");
            })
                .on("fileuploaded", function (event, data) {
                    if (data.response) {
//                        console.log(data)
                        /*上传成功时的回调函数*/
                        $("#photoRefId").val((data.response).imageId);
                    }
                });
        });
    </script>

</head>
<body class="theme">
<div class="container-fluid">
    <ul class="nav nav-tabs" th:fragment="header">

        <li th:class="${Nav.getCustom1() eq  'Y'} ? 'active'" th:each="Nav,NavStat : ${Nav.data}">
            <a th:href="@{${Nav.getInterlinkage()}}" th:text="${Nav.getMenuItemName()}">主页</a>
        </li>
        <!--<li>
            <a href="#">文章分享</a>
        </li>
        <li class="disabled">
            <a href="#">Messages</a>
        </li>-->
        <li class="pull-right set-nav-button" th:if="${#strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#login">
                登录
            </button>
        </li>
        <li class="pull-right set-nav-button" th:if="${#strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#register">
                注册
            </button>
        </li>

        <li class="pull-right set-nav-button" th:if="${! #strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary btn-sm">
                <a href="/authentication/logout" style="color: white;">
                    [登出]
                </a>
            </button>
        </li>

        <li class="pull-right" th:if="${! #strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <a th:text="${session.User.getUserName() + ',欢迎您'}" href="#" id="userstatus"></a>
        </li>
    </ul>

    <!-- 登录 -->
    <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="loginLabel"
         th:if="${#strings.isEmpty(session.User)}">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="loginLabel">登录</h4>
                </div>
                <div class="modal-body">

                    <form class="form-horizontal" role="form" action="/authentication/login" id="loginForm"
                          method="post">
                        <div class="form-group">

                            <label for="userNameOrEmail" class="col-sm-2 control-label">
                                账号:
                            </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="userNameOrEmail" name="userNameOrEmail"
                                       placeholder="登录名或者邮箱"/>
                            </div>
                        </div>
                        <div class="form-group">

                            <label for="password4log" class="col-sm-2 control-label">
                                密码:
                            </label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control" id="password4log" name="password4log"
                                       placeholder="登录密码"/>
                            </div>
                        </div>
                        <input type="hidden" id="currentURL4Login" name="currentURL4Login" value=""/>
                        <!--<div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">

                                    <label>
                                        <input type="checkbox" /> Remember me
                                    </label>
                                </div>
                            </div>
                        </div>-->
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="doLogin">登录</button>
                </div>
                <script>
                    $("#doLogin").on("click", function () {
                        var currentURL = window.location.href;
                        $("#currentURL4Login").val(currentURL);
                        $("#loginForm").submit();
                    })
                </script>
            </div>
        </div>
    </div>

    <!-- 注册 -->
    <div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="registerLabel"
         th:if="${#strings.isEmpty(session.User)}">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="registerLabel">注册</h4>
                    <div class="register-error" id="unknowError"></div>
                </div>
                <div class="modal-body">

                    <form class="form-horizontal" role="form" action="/authentication/register" id="registerForm"
                          method="post">
                        <div class="form-group">

                            <label for="userNameOrEmail" class="col-sm-2 control-label">
                                用户名:
                            </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="userName" name="userName"
                                       placeholder="用户名"/>
                            </div>
                            <div id="errorMessageUser" class="register-error"></div>
                        </div>
                        <div class="form-group">

                            <label for="userNameOrEmail" class="col-sm-2 control-label">
                                邮箱:
                            </label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="activeEmail" name="activeEmail"
                                       placeholder="邮箱"/>
                            </div>
                            <div id="errorMessageEmail" class="register-error"></div>
                        </div>
                        <div class="form-group">

                            <label for="password4log" class="col-sm-2 control-label">
                                密码:
                            </label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control" id="password4Register"
                                       name="password4Register"
                                       placeholder="登录密码"/>
                            </div>
                            <div id="errorPassword" class="register-error"></div>
                        </div>
                        <input type="hidden" id="currentURL4Register" name="currentURL4Register" value=""/>
                        <!--<div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">

                                    <label>
                                        <input type="checkbox" /> Remember me
                                    </label>
                                </div>
                            </div>
                        </div>-->
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary disabled" id="doRegister">注册</button>
                </div>
                <script src="/js/common/common.js" type="application/javascript"></script>
            </div>
        </div>
    </div>
    <div class="row set-margin-top">
        <div class="col-md-3">
            <form class="form-horizontal" id="formSubmit" action="/admin/updatePhotography" method="post">
                <input type="hidden" id="id" name="id" th:value="${PhotographyDetail.getId()}">
                <input type="hidden" id="photoRefId" name="photoRefId" th:value="${PhotographyDetail.getPhotoRefId()}">
                <div class="form-group">

                    <div class="col-sm-12">
                        <button id="saveBtn" type="button" class="btn btn-primary">保存</button>
                    </div>
                    <!--<div class="col-sm-6">
                        <button id="uploadImageBtn" type="button" class="btn btn-primary">上传图片</button>
                    </div>-->
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <input type="text" class="form-control" id="theme" name="theme" placeholder="主题"
                               th:value="${PhotographyDetail.getTheme()}">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                            <textarea class="form-control" rows="25" id="comments" name="comments"
                                      placeholder="描述" th:text="${PhotographyDetail.getComments()}"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-9">
            <!--<div class="preView"><img src="/images/camera.jpeg" alt="image" id="displayImage"></div>
            <div class="fileSelect"><input type="file" id="image" name="image"/></div>-->
            <!--<div class="fileButton"><input type="submit" value="上传"/></div>-->
            <div class="form-group">
                <div class="file-loading">
                    <input id="imageUpload" type="file" data-upload-url="/admin/savePhotographyImage">
                </div>
            </div>
        </div>
    </div>
</div>
<div th:include="common/footer"></div>
</body>

</html>