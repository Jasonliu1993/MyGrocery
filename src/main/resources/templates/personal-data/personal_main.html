<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Page Description"/>
    <meta name="author" content="Jason"/>
    <title>个人资料修改</title>

    <!-- Bootstrap -->
    <!--<link href="/css/bootstrap-3.3.7/css/bootstrap.css" rel="stylesheet"/>-->
    <link href="/css/common/pagination.css" rel="stylesheet"/>
    <link href="/css/common/common.css" rel="stylesheet"/>

    <link href="/css/bootstrap-3.3.7/css/bootstrap.css" rel="stylesheet">
    <link href="/plugins/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css"/>-->
    <link href="/plugins/bootstrap-fileinput/themes/explorer-fa/theme.css" media="all" rel="stylesheet"
          type="text/css"/>
    <script src="/js/jquery-3.1.1.min.js"></script>
    <script src="/js/jquerySession.js"></script>
    <script src="/plugins/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/js/locales/fr.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/js/locales/es.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/themes/explorer-fa/theme.js" type="text/javascript"></script>
    <script src="/plugins/bootstrap-fileinput/themes/fa/theme.js" type="text/javascript"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" type="text/javascript"></script>-->
    <script src="/js/bootstrap-3.3.7/js/bootstrap.js" type="text/javascript"></script>

    <style>
        .theme {
            background-color: #2e3032;
        }

        .set-margin-top {
            margin-top: 20px;
        }

        .set-left {
            height: 90%;
            clear: both;
        }

        .content {
            width: 100%;

            padding: 5px;

            background-color: white;
            border-radius: 3px;
        }

        .set-margin-top {
            margin: 10px auto;
        }

        img {
            width: 80%;
            margin: 10px auto;
        }

        #selectPic {
            /*width: 70px;*/
            /*height: 25px;*/
            /*background-color: #337ab7;*/
            /*border: 1px solid #2e6da4;*/
            /*border-radius: 5px;*/
            /*float: left;*/
            /*margin-left: 10px;*/
            /*text-decoration: none;*/
            /*font-size: 14px;*/
            /*text-align: center;*/
            /*color: #fff;*/
            /*font-weight: normal;*/
            /*line-height: 1.42857143;*/
            /*white-space: nowrap;*/
            /*vertical-align: middle;*/
            /*-ms-touch-action: manipulation;*/
            /*touch-action: manipulation;*/
            /*cursor: pointer;*/
        }

        input[type='file'] {
            width: 68px;
            height: 23px;
            background-color: green;
            border: 1px solid green;
            border-radius: 5px;
            float: left;
            margin-left: 10px;
            color: white;
            font-size: 15px;
            text-align: center;
            cursor: pointer;
            outline: medium none;
            position: absolute;
            filter: alpha(opacity=0);
            -moz-opacity: 0;
            opacity: 0;
            left: 0px;
            top: 0px;
        }

        .set-parent {
            position: relative;
        }

        .set-children {
            position: absolute;
            top: 0;
            right: 0;
        }

    </style>

    <script>
        var first = true;

        function setAdminMenuActive(currentType) {
            $(".nav-stacked li").each(function () {
                $(this).removeClass("active");
                $("#avatorUpload").css("display","none");
                $("#emailChange").css("display","none");
                $("#InfoChange").css("display","none");
            })
            $("#" + currentType + "").addClass("active");
            if (currentType == 'info') {
                $("#InfoChange").css("display","block");
            } else if (currentType == 'email') {
                $("#emailChange").css("display","block");
            } else {
                $("#avatorUpload").css("display","block");
            }
        }

        $(document).ready(function () {
            var baseURL = window.location.host;
            var protocol = window.location.protocol;

            /*浏览器返回事件*/
            if (window.history && window.history.pushState) {
//                window.history.go(-1);
                var URI = window.location.pathname;

                /*if(URL.substr(URI.length - 1,1) == '/') {
                 URL = URL.substring(1,URI.length - 1)
                 }*/

                if (first) {
                    console.log("运行avator");
                    setAdminMenuActive("avator");
                    first = false;
                }

                $(window).on('popstate', function () {
                    if (!first) {
                        var hashLocation = location.hash;
                        var hashSplit = hashLocation.split("#");
                        var hashName = hashSplit[1];

                        console.log(hashName);
                        if (hashName == 'info') {
                            console.log("运行info");
                            setAdminMenuActive("info");
                        } else if (hashName == 'email') {
                            console.log("运行email");
                            setAdminMenuActive("email");
                        } else {
                            console.log("运行avator");
                            setAdminMenuActive("avator");
                        }
                    }

                });

                window.history.pushState('forward', null, URI + '/#avator');
            }

            $(".nav-stacked li").on("click", function () {
                $("#currentType").val($(this).attr("id"));
                setAdminMenuActive($("#currentType").val())
            })

            $("#imageUpload").fileinput({
                theme: 'fa',
                'uploadUrl': '/image/saveImage',
                uploadExtraData: {kvId: '10'},
                uploadAsync: true,
                showUpload: true,
                showCaption: true,
                showPreview: true,
                showUploadedThumbs: true,
                fileType: "any",
                previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
                overwriteInitial: false,
                initialPreviewAsData: true,
                maxFileCount: 1,
                initialPreview: [
                    protocol + "//" + baseURL + "/image/avator/" + $("#id").val(),
                ],

            }).on("filebatchselected", function (event, files) {
                $(this).fileinput("upload");
            })
                .on("fileuploaded", function (event, data) {
                    if (data.response) {
//                        console.log(data)
                        /*上传成功时的回调函数*/
                        $("#photoRefId").val((data.response).imageId);
                    }
                });

        });
    </script>

</head>
<body class="theme">
<div class="container-fluid">
    <ul class="nav nav-tabs" th:fragment="header">

        <li th:class="${Nav.getCustom1() eq  'Y'} ? 'active'" th:each="Nav,NavStat : ${Nav.data}">
            <a th:href="@{${Nav.getInterlinkage()}}" th:text="${Nav.getMenuItemName()}">主页</a>
        </li>
        <!--<li>
            <a href="#">文章分享</a>
        </li>
        <li class="disabled">
            <a href="#">Messages</a>
        </li>-->
        <li class="pull-right set-nav-button" th:if="${#strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#login">
                登录
            </button>
        </li>
        <li class="pull-right set-nav-button" th:if="${#strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#register">
                注册
            </button>
        </li>

        <li class="pull-right set-nav-button" th:if="${! #strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary btn-sm">
                <a href="/authentication/logout" style="color: white;">
                    [登出]
                </a>
            </button>
        </li>

        <li class="pull-right" th:if="${! #strings.isEmpty(session.User)}">
            <!-- Button trigger modal -->
            <a th:text="${session.User.getUserName() + ',欢迎您'}" href="/personalPage/main" id="userstatus"></a>
        </li>
    </ul>

    <!-- 登录 -->
    <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="loginLabel"
         th:if="${#strings.isEmpty(session.User)}">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="loginLabel">登录</h4>
                </div>
                <div class="modal-body">

                    <form class="form-horizontal" role="form" action="/authentication/login" id="loginForm"
                          method="post">
                        <div class="form-group">

                            <label for="userNameOrEmail" class="col-sm-2 control-label">
                                账号:
                            </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="userNameOrEmail" name="userNameOrEmail"
                                       placeholder="登录名或者邮箱"/>
                            </div>
                        </div>
                        <div class="form-group">

                            <label for="password4log" class="col-sm-2 control-label">
                                密码:
                            </label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control" id="password4log" name="password4log"
                                       placeholder="登录密码"/>
                            </div>
                        </div>
                        <input type="hidden" id="currentURL4Login" name="currentURL4Login" value=""/>
                        <!--<div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">

                                    <label>
                                        <input type="checkbox" /> Remember me
                                    </label>
                                </div>
                            </div>
                        </div>-->
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="doLogin">登录</button>
                </div>
                <script>
                    $("#doLogin").on("click", function () {
                        var currentURL = window.location.href;
                        $("#currentURL4Login").val(currentURL);
                        $("#loginForm").submit();
                    })
                </script>
            </div>
        </div>
    </div>

    <!-- 注册 -->
    <div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="registerLabel"
         th:if="${#strings.isEmpty(session.User)}">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="registerLabel">注册</h4>
                    <div class="register-error" id="unknowError"></div>
                </div>
                <div class="modal-body">

                    <form class="form-horizontal" role="form" action="/authentication/register" id="registerForm"
                          method="post">
                        <div class="form-group">

                            <label for="userNameOrEmail" class="col-sm-2 control-label">
                                用户名:
                            </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="userName" name="userName"
                                       placeholder="用户名"/>
                            </div>
                            <div id="errorMessageUser" class="register-error"></div>
                        </div>
                        <div class="form-group">

                            <label for="userNameOrEmail" class="col-sm-2 control-label">
                                邮箱:
                            </label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="activeEmail" name="activeEmail"
                                       placeholder="邮箱"/>
                            </div>
                            <div id="errorMessageEmail" class="register-error"></div>
                        </div>
                        <div class="form-group">

                            <label for="password4log" class="col-sm-2 control-label">
                                密码:
                            </label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control" id="password4Register"
                                       name="password4Register"
                                       placeholder="登录密码"/>
                            </div>
                            <div id="errorPassword" class="register-error"></div>
                        </div>
                        <input type="hidden" id="currentURL4Register" name="currentURL4Register" value=""/>
                        <!--<div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">

                                    <label>
                                        <input type="checkbox" /> Remember me
                                    </label>
                                </div>
                            </div>
                        </div>-->
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary disabled" id="doRegister">注册</button>
                </div>
                <script src="/js/common/common.js" type="application/javascript"></script>
            </div>
        </div>
    </div>

    <div class="row set-margin-top">
        <div class="col-md-2">
            <div class="set-left">
                <ul class="nav nav-pills nav-stacked">
                    <li role="presentation" th:id="${PersonalMenu.getLinkMatching()}"
                        th:each="PersonalMenu,PersonalMenuStatus : ${PersonalMenus.data}"><a
                            th:href="@{${PersonalMenu.getInterlinkage()}}"
                            th:text="${PersonalMenu.getMenuItemName()}">Home</a></li>
                    <!--<li role="presentation" class="active"><a href="#">Profile</a></li>
                    <li role="presentation"><a href="#">Messages</a></li>-->
                </ul>
            </div>
        </div>
        <input type="hidden" id="id" th:value="${session.User.getPersonalInfo().getAvator()}">
        <div class="col-md-10">
            <div class="content" id="avatorUpload">
                <h3 style="text-align: center">以最后一个上传的为准</h3>
                <form enctype="multipart/form-data">
                    <!--<div class="file-loading">
                        <input id="imageUpload" type="file" data-upload-url="/admin/savePhotographyImage" data-min-file-count="1">
                    </div>-->
                    <div class="file-loading">
                        <input id="imageUpload" type="file" data-min-file-count="1">
                    </div>
                </form>
            </div>
            <div class="content" id="emailChange">
                <h3 style="text-align: center">邮箱修改</h3>

            </div>
            <div class="content" id="InfoChange">
                <h3 style="text-align: center">个人信息修改</h3>

            </div>
        </div>
    </div>
</div>
<!--<input type="hidden" id="currentType" name="currentType" th:value="${CurrentType}">-->
<div th:include="common/footer"></div>

</body>
</html>